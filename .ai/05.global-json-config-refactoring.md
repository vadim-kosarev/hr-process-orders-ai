# JSON Serialization Configuration Refactoring

## Summary
Переведена конфигурация игнорирования неизвестных свойств из локальных аннотаций в глобальную конфигурацию `ObjectMapper`.

## Problem
Было добавлено много `@JsonIgnoreProperties(ignoreUnknown = true)` аннотаций на разные классы - это приводит к дублированию кода и усложнению поддержки.

## Solution
Настроена глобальная конфигурация в `AppConfig.objectMapper()` bean, которая применяется ко всему приложению.

## Configuration Changes

### AppConfig.java - ObjectMapper Bean
```java
@Bean
public ObjectMapper objectMapper() {
    ObjectMapper mapper = new ObjectMapper();

    // Игнорирование неизвестных свойств при десериализации (глобально)
    mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
    
    // Также игнорировать пустые bean'ы
    mapper.configure(DeserializationFeature.FAIL_ON_MISSING_CREATOR_PROPERTIES, false);
    
    // Поддержка типизации через аннотации Jackson
    mapper.configure(DeserializationFeature.USE_GETTERS_AS_SETTERS, true);

    // ... остальная конфигурация времени
}
```

### Ключевые параметры:

1. **FAIL_ON_UNKNOWN_PROPERTIES = false**
   - Игнорирует неизвестные поля в JSON при десериализации
   - Применяется глобально ко всем сериализуемым объектам

2. **FAIL_ON_MISSING_CREATOR_PROPERTIES = false**
   - Обрабатывает ситуации, когда не все required поля присутствуют в JSON

3. **USE_GETTERS_AS_SETTERS = true**
   - Поддерживает типизацию через Jackson аннотации (@JsonTypeInfo, @JsonSubTypes)

## Files Cleaned Up

### Commands
- `OrderCommand.java` - удалена @JsonIgnoreProperties
- `CreateOrderCommand.java` - удалена @JsonIgnoreProperties из 3 мест

### Events
- `OrderEvent.java` - удалена @JsonIgnoreProperties
- `OrderServiceEvent.java` - удалена @JsonIgnoreProperties
- `OrderCreatedEvent.java` - удалена @JsonIgnoreProperties
- `OrderProcessingStartedEvent.java` - удалена @JsonIgnoreProperties
- `OrderProcessingFailedEvent.java` - удалена @JsonIgnoreProperties
- `OrderReadyEvent.java` - удалена @JsonIgnoreProperties
- `OrderCancelledEvent.java` - удалена @JsonIgnoreProperties

### Value Objects
- `OrderID.java` - удалена @JsonIgnoreProperties

## Benefits

✅ **DRY Principle**: Конфигурация в одном месте, а не дублируется в 10+ классах  
✅ **Maintainability**: Легче менять поведение JSON обработки - одна точка изменения  
✅ **Cleaner Code**: Домен классы больше не замусорены Jackson аннотациями  
✅ **Consistency**: Единое поведение для всех команд и событий  
✅ **Flexibility**: Легко адаптировать к новым требованиям без тронения доменных классов

## How It Works

1. **Kafka сообщение приходит** в JSON формате
2. **JsonMessageConverter** использует настроенный `ObjectMapper`
3. **ObjectMapper** десериализует JSON:
   - Читает тип из `@JsonTypeInfo` поля
   - Выбирает конкретный класс из `@JsonSubTypes`
   - Создаёт экземпляр правильного типа
   - Игнорирует неизвестные поля согласно конфигурации
4. **Результат**: Типизированный объект команды или события готов к обработке

## Backward Compatibility

✅ Полная обратная совместимость  
✅ Все существующие сообщения обрабатываются также как раньше  
✅ Просто более гибко и без лишних аннотаций

